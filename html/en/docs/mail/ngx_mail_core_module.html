<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Module ngx_mail_core_module</title><style type="text/css">body { background: white; color: black; font-family: sans-serif; line-height: 1.4em; text-align: center; margin: 0; padding: 0; } #banner { background: black; color: #F2F2F2; line-height: 1.2em; padding: .3em 0; box-shadow: 0 5px 10px black; } #banner a { color: #00B140; } #main { text-align: left; margin: 0 auto; min-width: 32em; max-width: 64em; } #menu { float: right; width: 11em; padding: 0 .5em 1em .5em; border-left: 2px solid #DDD; } #content { margin-right: 13.5em; padding: 0 .2em 0 1.5em; } h1 { display: block; font-size: 3em; text-align: left; height: .7em; margin: 0; margin-bottom: .5em; } h1 img { width: 100%; } h2 { text-align: center; } p { text-align: justify; } table.news p { margin-top: 0; } table.news td { vertical-align: baseline; } table.news .date { text-align: right; padding-right: 0.5em; white-space: nowrap; } table.donors td { vertical-align: baseline; } table.donors li { text-align: left; } div.directive { background: #F2F2F2; line-height: 1em; margin: 1em 0 1em -1em; padding: .7em .7em .7em 1em; border-top: 2px solid #DDD; } div.directive th { padding-left: 0; padding-right: .5em; vertical-align: baseline; text-align: left; font-weight: normal; } div.directive td { vertical-align: baseline; } div.directive pre { padding: 0; margin: 0; } div.directive p { margin: .5em 0 0 .1em; font-size: .8em; } a.notrans { color: gray; text-decoration:none; } span.initial { font-size: 200%; float: left; padding-right: 10pt;} ul, ol { margin: .5em 0 1em 1em; padding: 0 .5em; } ol { list-style-position: inside; } li { text-align: justify; padding: .5em 0 0 1px; } .compact li { padding-top: 0; } dl { margin: .5em 0 1em 0; } dt { margin: .5em 0; } .compact dt { margin-bottom: .2em; } dd { margin-left: 1.5em; padding-left: 1px; text-align: justify; } td.list { background: #F2F2F2; } blockquote { margin: 1em 0 1em 1em; padding: .5em; } li blockquote, dd blockquote { margin: .7em 0; } blockquote.note { border: 1px dotted #999; line-height: 1.2em; text-align: justify; } blockquote.example { line-height: 1em; border-left: 1px solid #BBB; } blockquote.example pre { padding: 0; margin: 0; } sup { font-size: 50%; }</style><script>
        (function(w, d, s, l, i) {
            w[l] = w[l] || [];
            w[l].push({
                'gtm.start': new Date().getTime(),
                event: 'gtm.js'
            });
            var f = d.getElementsByTagName(s)[0],
                j = d.createElement(s),
                dl = l != 'dataLayer' ? '&l=' + l : '';
            j.async = true;
            j.src = '//www.googletagmanager.com/gtm.js?id=' + i + dl;
            f.parentNode.insertBefore(j, f);
        })(window, document, 'script', 'dataLayer', 'GTM-TPSP33');
    </script></head><body><div id="banner"><strong>Announcing NGINX Plus R11</strong><br>
        Check out our latest release with easier dynamic module integration, additional TCP/UDP<br> load-balancing features, enhancements to nginScript, support for GeoIP2, and more.
        <a href="https://www.nginx.com/blog/nginx-plus-r11-released/?utm_source=nginxorg&amp;utm_medium=header&amp;utm_campaign=product&amp;utm_content=r11"><em>Explore R11</em></a><br></div><div id="main"><div id="menu"><h1><a href="/"><img src="/nginx.png" alt="nginx"></a></h1><div>english<br><a href="../../../ru/docs/mail/ngx_mail_core_module.html">русский</a><br><br><a href="../../../">news</a><br><a href="../../../en/">about</a><br><a href="../../../en/download.html">download</a><br><a href="../../../en/security_advisories.html">security</a><br><a href="../../../en/docs/">documentation</a><br><a href="../../../en/docs/faq.html">faq</a><br><a href="../../../en/books.html">books</a><br><a href="../../../en/support.html">support</a><br><br><a href="http://trac.nginx.org/nginx">trac</a><br><a href="http://wiki.nginx.org/">wiki</a><br><a href="http://twitter.com/nginxorg">twitter</a><br><a href="https://www.nginx.com/blog/">blog</a><br></div></div><div id="content"><h2>Module ngx_mail_core_module</h2><table width="100%"><tr><td align="left"><a href="#example">Example Configuration</a><br><a href="#directives">Directives</a><br>     <a href="#listen">listen</a><br>     <a href="#mail">mail</a><br>     <a href="#protocol">protocol</a><br>     <a href="#resolver">resolver</a><br>     <a href="#resolver_timeout">resolver_timeout</a><br>     <a href="#server">server</a><br>     <a href="#server_name">server_name</a><br>     <a href="#timeout">timeout</a><br></td></tr></table>

<a name="summary"></a><p>
This module is not built by default, it should be
enabled with
the <code>--with-mail</code> configuration parameter.
</p>


<a name="example"></a><center><h4>Example Configuration</h4></center><p>
</p> <blockquote class="example"><pre>
worker_processes 1;

error_log /var/log/nginx/error.log info;

events {
    worker_connections  1024;
}

mail {
    server_name       mail.example.com;
    auth_http         localhost:9000/cgi-bin/nginxauth.cgi;

    imap_capabilities IMAP4rev1 UIDPLUS IDLE LITERAL+ QUOTA;

    pop3_auth         plain apop cram-md5;
    pop3_capabilities LAST TOP USER PIPELINING UIDL;

    smtp_auth         login plain cram-md5;
    smtp_capabilities "SIZE 10485760" ENHANCEDSTATUSCODES 8BITMIME DSN;
    xclient           off;

    server {
        listen   25;
        protocol smtp;
    }
    server {
        listen   110;
        protocol pop3;
        proxy_pass_error_message on;
    }
    server {
        listen   143;
        protocol imap;
    }
    server {
        listen   587;
        protocol smtp;
    }
}
</pre></blockquote><p> 
</p>


<a name="directives"></a><center><h4>Directives</h4></center><a name="listen"></a><div class="directive"><table cellspacing="0">
                <tr>
                <th>
            Syntax:
                </th>
                <td>
            <code><strong>listen</strong> 
    <code><i>address</i></code>:<code><i>port</i></code>
    [<code>ssl</code>]
    [<code>backlog</code>=<code><i>number</i></code>]
    [<code>bind</code>]
    [<code>ipv6only</code>=<code>on</code>|<code>off</code>]
    [<code>so_keepalive</code>=<code>on</code>|<code>off</code>|[<code><i>keepidle</i></code>]:[<code><i>keepintvl</i></code>]:[<code><i>keepcnt</i></code>]];</code><br>
                </td>
                </tr>
            
                <tr>
                <th>
            Default:
                </th>
                <td>
            
            —
        
                </td>
                </tr>
            
                <tr>
                <th>
            Context:
                </th>
                <td>
            <code>server</code><br>
                </td>
                </tr>
            </table></div><p>
Sets the <code><i>address</i></code> and <code><i>port</i></code> for the socket
on which the server will accept requests.
It is possible to specify just the port.
The address can also be a hostname, for example:
</p> <blockquote class="example"><pre>
listen 127.0.0.1:110;
listen *:110;
listen 110;     # same as *:110
listen localhost:110;
</pre></blockquote><p> 
IPv6 addresses (0.7.58) are specified in square brackets:
</p> <blockquote class="example"><pre>
listen [::1]:110;
listen [::]:110;
</pre></blockquote><p> 
UNIX-domain sockets (1.3.5) are specified with the “<code>unix:</code>”
prefix:
</p> <blockquote class="example"><pre>
listen unix:/var/run/nginx.sock;
</pre></blockquote><p> 

</p><p>
Different servers must listen on different
<code><i>address</i></code>:<code><i>port</i></code> pairs.
</p><p>
The <code>ssl</code> parameter allows specifying that all
connections accepted on this port should work in SSL mode.
</p><p>
The <code>listen</code> directive
can have several additional parameters specific to socket-related system calls.
</p> <dl class="compact">

<dt>
<code>backlog</code>=<code><i>number</i></code>
</dt>
<dd>
sets the <code>backlog</code> parameter in the
<code>listen()</code> call that limits
the maximum length for the queue of pending connections (1.9.2).
By default,
<code>backlog</code> is set to -1 on FreeBSD, DragonFly BSD, and Mac OS X,
and to 511 on other platforms.
</dd>

<dt>
<code>bind</code>
</dt>
<dd>
this parameter instructs to make a separate <code>bind()</code>
call for a given address:port pair.
The fact is that if there are several <code>listen</code> directives with
the same port but different addresses, and one of the
<code>listen</code> directives listens on all addresses
for the given port (<code>*:</code><code><i>port</i></code>), nginx will
<code>bind()</code> only to <code>*:</code><code><i>port</i></code>.
It should be noted that the <code>getsockname()</code> system call will be
made in this case to determine the address that accepted the connection.
If the <code>ipv6only</code>
or <code>so_keepalive</code> parameters
are used then for a given
<code><i>address</i></code>:<code><i>port</i></code> pair
a separate <code>bind()</code> call will always be made.
</dd>

<dt>
<code>ipv6only</code>=<code>on</code>|<code>off</code>
</dt>
<dd>
this parameter determines
(via the <code>IPV6_V6ONLY</code> socket option)
whether an IPv6 socket listening on a wildcard address <code>[::]</code>
will accept only IPv6 connections or both IPv6 and IPv4 connections.
This parameter is turned on by default.
It can only be set once on start.
</dd>

<dt>
<code>so_keepalive</code>=<code>on</code>|<code>off</code>|[<code><i>keepidle</i></code>]:[<code><i>keepintvl</i></code>]:[<code><i>keepcnt</i></code>]
</dt>
<dd>
this parameter configures the “TCP keepalive” behavior
for the listening socket.
If this parameter is omitted then the operating system’s settings will be
in effect for the socket.
If it is set to the value “<code>on</code>”, the
<code>SO_KEEPALIVE</code> option is turned on for the socket.
If it is set to the value “<code>off</code>”, the
<code>SO_KEEPALIVE</code> option is turned off for the socket.
Some operating systems support setting of TCP keepalive parameters on
a per-socket basis using the <code>TCP_KEEPIDLE</code>,
<code>TCP_KEEPINTVL</code>, and <code>TCP_KEEPCNT</code> socket options.
On such systems (currently, Linux 2.4+, NetBSD 5+, and
FreeBSD 9.0-STABLE), they can be configured
using the <code><i>keepidle</i></code>, <code><i>keepintvl</i></code>, and
<code><i>keepcnt</i></code> parameters.
One or two parameters may be omitted, in which case the system default setting
for the corresponding socket option will be in effect.
For example,
<blockquote class="example"><pre>so_keepalive=30m::10</pre></blockquote>
will set the idle timeout (<code>TCP_KEEPIDLE</code>) to 30 minutes,
leave the probe interval (<code>TCP_KEEPINTVL</code>) at its system default,
and set the probes count (<code>TCP_KEEPCNT</code>) to 10 probes.
</dd>

</dl><p> 
</p><a name="mail"></a><div class="directive"><table cellspacing="0">
                <tr>
                <th>
            Syntax:
                </th>
                <td>
            <code><strong>mail</strong> { ... }</code><br>
                </td>
                </tr>
            
                <tr>
                <th>
            Default:
                </th>
                <td>
            
            —
        
                </td>
                </tr>
            
                <tr>
                <th>
            Context:
                </th>
                <td>
            <code>main</code><br>
                </td>
                </tr>
            </table></div><p>
Provides the configuration file context in which the mail server directives
are specified.
</p><a name="protocol"></a><div class="directive"><table cellspacing="0">
                <tr>
                <th>
            Syntax:
                </th>
                <td>
            <code><strong>protocol</strong> 
  <code>imap</code> |
  <code>pop3</code> |
  <code>smtp</code>;</code><br>
                </td>
                </tr>
            
                <tr>
                <th>
            Default:
                </th>
                <td>
            
            —
        
                </td>
                </tr>
            
                <tr>
                <th>
            Context:
                </th>
                <td>
            <code>server</code><br>
                </td>
                </tr>
            </table></div><p>
Sets the protocol for a proxied server.
Supported protocols are
<a href="ngx_mail_imap_module.html">IMAP</a>,
<a href="ngx_mail_pop3_module.html">POP3</a>, and
<a href="ngx_mail_smtp_module.html">SMTP</a>.
</p><p>
If the directive is not set, the protocol can be detected automatically
based on the well-known port specified in the <a href="#listen">listen</a>
directive:
</p> <ul class="compact">

<li>
<code>imap</code>: 143, 993
</li>

<li>
<code>pop3</code>: 110, 995
</li>

<li>
<code>smtp</code>: 25, 587, 465
</li>

</ul><p> 
</p><p>
Unnecessary protocols can be disabled using the
<a href="../configure.html">configuration</a>
parameters <code>--without-mail_imap_module</code>,
<code>--without-mail_pop3_module</code>, and
<code>--without-mail_smtp_module</code>.
</p><a name="resolver"></a><div class="directive"><table cellspacing="0">
                <tr>
                <th>
            Syntax:
                </th>
                <td>
            <code><strong>resolver</strong> 
<code><i>address</i></code> ...
[<code>valid</code>=<code><i>time</i></code>];</code><br><code><strong>resolver</strong> <code>off</code>;</code><br>
                </td>
                </tr>
            
                <tr>
                <th>
            Default:
                </th>
                <td>
            <pre>resolver off;</pre>
                </td>
                </tr>
            
                <tr>
                <th>
            Context:
                </th>
                <td>
            <code>mail</code>, <code>server</code><br>
                </td>
                </tr>
            </table></div><p>
Configures name servers used to find the client’s hostname
to pass it to the
<a href="ngx_mail_auth_http_module.html">authentication server</a>,
and in the
<a href="ngx_mail_proxy_module.html#xclient">XCLIENT</a>
command when proxying SMTP.
For example:
</p> <blockquote class="example"><pre>
resolver 127.0.0.1 [::1]:5353;
</pre></blockquote><p> 
An address can be specified as a domain name or IP address,
and an optional port (1.3.1, 1.2.2).
If port is not specified, the port 53 is used.
Name servers are queried in a round-robin fashion.
</p> <blockquote class="note">
Before version 1.1.7, only a single name server could be configured.
Specifying name servers using IPv6 addresses is supported
starting from versions 1.3.1 and 1.2.2.
</blockquote><p> 
By default, nginx caches answers using the TTL value of a response.
An optional <code>valid</code> parameter allows overriding it:
</p> <blockquote class="example"><pre>
resolver 127.0.0.1 [::1]:5353 valid=30s;
</pre></blockquote><p> 
</p> <blockquote class="note">
Before version 1.1.9, tuning of caching time was not possible,
and nginx always cached answers for the duration of 5 minutes.
</blockquote><p> 
</p><p>
The special value <code>off</code> disables resolving.
</p><a name="resolver_timeout"></a><div class="directive"><table cellspacing="0">
                <tr>
                <th>
            Syntax:
                </th>
                <td>
            <code><strong>resolver_timeout</strong> <code><i>time</i></code>;</code><br>
                </td>
                </tr>
            
                <tr>
                <th>
            Default:
                </th>
                <td>
            <pre>resolver_timeout 30s;</pre>
                </td>
                </tr>
            
                <tr>
                <th>
            Context:
                </th>
                <td>
            <code>mail</code>, <code>server</code><br>
                </td>
                </tr>
            </table></div><p>
Sets a timeout for DNS operations, for example:
</p> <blockquote class="example"><pre>
resolver_timeout 5s;
</pre></blockquote><p> 
</p><a name="server"></a><div class="directive"><table cellspacing="0">
                <tr>
                <th>
            Syntax:
                </th>
                <td>
            <code><strong>server</strong> { ... }</code><br>
                </td>
                </tr>
            
                <tr>
                <th>
            Default:
                </th>
                <td>
            
            —
        
                </td>
                </tr>
            
                <tr>
                <th>
            Context:
                </th>
                <td>
            <code>mail</code><br>
                </td>
                </tr>
            </table></div><p>
Sets the configuration for a server.
</p><a name="server_name"></a><div class="directive"><table cellspacing="0">
                <tr>
                <th>
            Syntax:
                </th>
                <td>
            <code><strong>server_name</strong> <code><i>name</i></code>;</code><br>
                </td>
                </tr>
            
                <tr>
                <th>
            Default:
                </th>
                <td>
            <pre>server_name hostname;</pre>
                </td>
                </tr>
            
                <tr>
                <th>
            Context:
                </th>
                <td>
            <code>mail</code>, <code>server</code><br>
                </td>
                </tr>
            </table></div><p>
Sets the server name that is used:
</p> <ul class="compact">

<li>
in the initial POP3/SMTP server greeting;
</li>

<li>
in the salt during the SASL CRAM-MD5 authentication;
</li>

<li>
in the <code>EHLO</code> command when connecting to the SMTP backend,
if the passing of the
<a href="ngx_mail_proxy_module.html#xclient">XCLIENT</a> command
is enabled.
</li>

</ul><p> 
</p><p>
If the directive is not specified, the machine’s hostname is used.
</p><a name="timeout"></a><div class="directive"><table cellspacing="0">
                <tr>
                <th>
            Syntax:
                </th>
                <td>
            <code><strong>timeout</strong> <code><i>time</i></code>;</code><br>
                </td>
                </tr>
            
                <tr>
                <th>
            Default:
                </th>
                <td>
            <pre>timeout 60s;</pre>
                </td>
                </tr>
            
                <tr>
                <th>
            Context:
                </th>
                <td>
            <code>mail</code>, <code>server</code><br>
                </td>
                </tr>
            </table></div><p>
Sets the timeout that is used before proxying to the backend starts.
</p>

</div></div></body></html>
